<!DOCTYPE html>
<html>
<head>
    <title>New Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            background-color: #fff;
            padding: 0;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }
        
        iframe {
            border: 0;
            flex-grow: 1;
            width: 100%;
            height: 100%;
        }

        /* Mobile controls */
        #mobile-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 1000;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            margin: 5px;
            background-color: rgba(255, 255, 255, 0.5);
            border: 2px solid #333;
            border-radius: 50%;
            touch-action: manipulation;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            -webkit-user-select: none;
            user-select: none;
        }

        #arrow-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }

        @media (max-width: 768px) {
            #mobile-controls {
                display: block;
            }
        }
    </style>
</head>
<body>
    <iframe allow="fullscreen" src="https://flowlab.io/game/embed/2648832" id="gameFrame"></iframe>
    
    <div id="mobile-controls">
        <div id="arrow-container">
            <div></div>
            <button class="control-btn" id="upBtn">↑</button>
            <div></div>
            <button class="control-btn" id="leftBtn">←</button>
            <button class="control-btn" id="downBtn">↓</button>
            <button class="control-btn" id="rightBtn">→</button>
        </div>
    </div>

    <script>
        // Function to simulate keyboard events in the iframe
        function simulateKey(keyCode, type) {
            const iframe = document.getElementById('gameFrame');
            const event = new KeyboardEvent(type, {
                bubbles: true,
                cancelable: true,
                keyCode: keyCode,
                which: keyCode,
                key: getKeyFromCode(keyCode),
                code: getCodeFromKeyCode(keyCode)
            });
            
            try {
                // Try to send the event to the iframe content window
                if (iframe.contentWindow) {
                    iframe.contentWindow.postMessage({
                        type: 'keyEvent',
                        eventType: type,
                        keyCode: keyCode
                    }, '*');
                }
            } catch (e) {
                console.error('Error sending key event to iframe:', e);
            }
        }

        // Helper function to get key name from key code
        function getKeyFromCode(keyCode) {
            const keyMap = {
                37: 'ArrowLeft',
                38: 'ArrowUp',
                39: 'ArrowRight',
                40: 'ArrowDown'
            };
            return keyMap[keyCode] || '';
        }

        // Helper function to get code from key code
        function getCodeFromKeyCode(keyCode) {
            const codeMap = {
                37: 'ArrowLeft',
                38: 'ArrowUp',
                39: 'ArrowRight',
                40: 'ArrowDown'
            };
            return codeMap[keyCode] || '';
        }

        // Touch event handlers for mobile controls
        const buttons = {
            'upBtn': 38,    // Up arrow key code
            'downBtn': 40,  // Down arrow key code
            'leftBtn': 37,  // Left arrow key code
            'rightBtn': 39  // Right arrow key code
        };

        Object.entries(buttons).forEach(([btnId, keyCode]) => {
            const button = document.getElementById(btnId);
            
            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                simulateKey(keyCode, 'keydown');
            });

            button.addEventListener('touchend', (e) => {
                e.preventDefault();
                simulateKey(keyCode, 'keyup');
            });

            // Add mouse events for testing on desktop
            button.addEventListener('mousedown', (e) => {
                e.preventDefault();
                simulateKey(keyCode, 'keydown');
            });

            button.addEventListener('mouseup', (e) => {
                e.preventDefault();
                simulateKey(keyCode, 'keyup');
            });
        });

        // Prevent default touch behavior to avoid scrolling
        document.addEventListener('touchmove', (e) => {
            if (e.target.className === 'control-btn') {
                e.preventDefault();
            }
        }, { passive: false });

        // Adjust iframe size on window resize
        function resizeFrame() {
            const iframe = document.querySelector('iframe');
            const windowRatio = window.innerWidth /
